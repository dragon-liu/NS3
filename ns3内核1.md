## 一.ns-3的组织结构

​	ns-3是一个离散事件仿真软件，它的内核和模块都是用C++语言实现的。实质上，ns-3可以认为是一个动态或者静态的库，这些库函数（API）可以供由C++语言所编写的仿真程序调用。同样，ns-3也实现了支持Python语言库函数，Python仿真程序可以像C++语言调用库函数的方法调用ns-3提供的API。也就是说，ns-3提供2种语言的支持，用户只需要懂得其中一种语言就可以轻松地使用ns-3来编写自己的仿真程序。

​	ns-3是一个开源的软件，它的整体组织结构在src目录中实现。从上到下ns-3的每个模块仅仅依赖于它的底层模块，也就是说底层模块为上层模块提供服务。

​	首先来认识一下内核模块，内核模块对于现在所有的协议、硬件以及场景模型都是通用的，可以在目录src/core中查看内核的源代码。分组在网络中是最基本的单元，因此在仿真中对分组的刻画也是必不可少的，在src/network中读者可以找到有关分组的实现代码。内核和网络这2个模块的实现旨在为不同的网络仿真提供一般性服务，而不仅仅是单纯地只为因特网服务。而在网络模块以上的模块的使用要依赖于不同的网络仿真，针对不同网络仿真程序使用的ns-3模块也是大有不同的，如对于移动网络需要移动模型，不同的移动网络，其移动模型还可能不一样，这都要针对具体的网络要求来定。

![1562311923709](C:\Users\win10\AppData\Roaming\Typora\typora-user-images\1562311923709.png)



## 二.随机变量

#### 1.背景

​	因网络仿真实验中，CPU将花掉不少时间来处理随机数，因此用户不得不去关注随机数的效率和不同随机数之间的独立性，下面是用户不得不经常考虑的问题：

- 在仿真实验中使用到的随机数是否有真实的随机性或可靠的随机性
- 在多次实验中如何保证随机数之间的独立性
- 一个随机数生成序列的周期长度

首先得了解上述几个术语，每一个RNG（随机数生成器）都会提供一个相当长的随机数序列，这个序列的长度称为循环周期或者循环长度，RNG在完成一次循环后将自动进行下一次重复。这个序列可以被分隔为几个相互没有关联的数据流。一个RNG的随机数据流是这个RNG序列的一个连续子集。例如，一个RNG队列长度为N，同时RNG提供2个数据流，第一个数据流使用序列的前半部分，第二个数据流使用序列的后半部分，当然这里最重要的是：**这2个数据流是相互独立的。**同样，每一个数据流还可以被分为更小的子流。**一个RNG最希望做到的就是提供一个非常长的循环序列，并有效地分配给每一个数据流。**



#### 2.综述

​	ns-3的随机变量是通过调用类ns3：：RandomVariableStream来提供的。类ns:：Random VariableStream 是对底层的随机数生成器进行封装并提供相关的接口供用户使用（Uniform VariableStream 和ExponetialVariableStream是RandomVariable Stream的子类）。

​	如果仿真程序具有随机性，而要在相同的仿真中体现结果的随机性，那么就要提供不同的种子或者运行标识。可以通过函数 ns3：：RngSeedManager:SetSeed）来设置种子，同样通过函数ns3：：RngSeedManager:SetRun）设置运行标识。

​	ns-3中用到的每一个随机变量都有一个随机数生成器与之相关联，所有的随机变量都使用一个基于全局固定的或者随机的种子。



#### 3.播种与独立重复

​	通过对ns-3进行配置可以让输出结果是确定的也可以是随机的。如果ns-3在仿真模拟中使用固定的种子和不变运行标识，那么每一次仿真结果都是固定不变的。ns-3默认使用固定的种子和标识，它们分别存储在类GlobalValue的g_rmgseed和g_rmgRun成员中。

​	但是，人们通常会对同一仿真程序进行多次运行实验，对结果进行统计分析。为了使结果更具有科学性，那么应该让每次实验都具有独立性，这里提供2种方法。

- 在每一次独立重复实验时，调用RngSeedManager:：SetSeed）为其设置不同的全局种子。

  示例如下，可以通过SetSeed传入不同参数使其具有独立性，但每次实验都要修改源代码，显然不明智

  ![1562313007946](C:\Users\win10\AppData\Roaming\Typora\typora-user-images\1562313007946.png)

- 在保持种子不变的情况下，通过改变运行标识来保证实验的独立性。改变标识的方法有以下4种。

a.通过函数RngSeedManager:SetRun（3）改变运行标识。

b.通过修改环境变量NSGLOGALVALUEB的值来修改运行标识。代码如下：

```c++
NS GLOBAL VALUE="RngRun=3" ./waf --run program-name
```

c.通过命令行传递参数来修改运行标识，如下：

```c++
./waf --run "program-name --RngRun=3"
```

d.还有一种方式就是不用waf，而是直接用build。如：

```c++
./build/optimized/scratch/program-name --RngRun=3
```

建议使用第3种方式。

**在这里提倡在保持种子不变的情况下，通过改变运行标识保证独立性，因为在改变种子的情况下进行重复实验，ns3无法保证每个种子对应的RNG序列不会重复，而使用相同种子对应的RNG子序列就能保证每个序列不会重复。**

**这里要注意的是在改变运行标识时，程序的种子是没有改变的，所以对应的RNG序列没有变化，只是把这个序列分割成很多小的子序列来供每次运行使用。**



#### 4.随机变量

​	下面介绍ns3中提供的用来声明随机变量的类。首先，所有用来声明随机变量的类都有一个基类Random VariableStream。下面简单介绍从RandomVariableStream继承的派生类。

- UniformRandomVariable：最基础也是最常用的类。
  给定一个最大值和最小值，按均匀分布的方式返回一个随机数。

![1562313830395](C:\Users\win10\AppData\Roaming\Typora\typora-user-images\1562313830395.png)

- ConstantRandomVariable：返回一个固定的数，默认值为0。
- SequentialRandomVariable：返回一串等差序列，如果超过了给定的最大上限则重新从给定的最小值开始再次循环。
- ExponentialRandomVariable：根据指数概率分布返回随机数。
- NormalRandomVariable：根据正态分布返回随机数。